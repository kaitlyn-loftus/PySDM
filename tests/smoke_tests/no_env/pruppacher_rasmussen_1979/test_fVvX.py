"""
test checking values from Pruppacher and Rassmussen (1979) Figure 1
"""

import numpy as np
import pytest
from PySDM import Formulae


# digitized from Pruppacher and Rassmussen (1979) Figure 1
@pytest.mark.parametrize(
    "X, fV",
    (
        (0.1329639889196676, 1.0201096892138939),
        (0.664819944598338, 1.0201096892138939),
        (1.662049861495845, 1.2504570383912248),
        (3.988919667590028, 1.9744058500914077),
        (6.581717451523546, 2.7970749542961606),
        (9.4404432132964, 3.685557586837294),
        (11.168975069252078, 4.212065813528336),
        (13.495844875346261, 4.936014625228519),
        (16.686980609418285, 5.9561243144424125),
        (20.210526315789476, 7.074954296160877),
        (23.534626038781166, 8.12797074954296),
        (27.52354570637119, 9.345521023765995),
        (30.84764542936288, 10.39853747714808),
        (34.57063711911358, 11.583180987202924),
        (38.1606648199446, 12.702010968921389),
        (41.21883656509696, 13.656307129798902),
        (44.60941828254848, 14.742230347349176),
        (48.53185595567867, 15.926873857404022),
    ),
)
def test_fVvX_fig1(X, fV, rtol=5e-2):
    formulae = Formulae(ventilation="PruppacherRasmussen")
    fV_test = formulae.ventilation.calcfV(X)
    np.testing.assert_allclose(fV_test, fV, rtol=rtol)
